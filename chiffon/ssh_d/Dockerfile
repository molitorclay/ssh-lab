# ssh_d Dockerfile
# Needs 'port' file with port for sshd
# self ssh
COPY --chown=$USER:$USER ssh_c/ssh/id_ed25519.pub /home/$USER/.ssh/authorized_keys
RUN chmod 600         /home/$USER/.ssh/authorized_keys

# Grab port generated by build.sh and add to sshd_config
COPY $SELF/port ./port
RUN echo "Port "$(cat port) >> /etc/ssh/sshd_config
RUN rm ./port

# Password for connecting to E. Needed by D's ssh key 
COPY $SELF/pass ./pass
# enable unstable packages 
RUN echo "@testing https://dl-cdn.alpinelinux.org/alpine/edge/testing" >> /etc/apk/repositories
# Turn password into png file, to force file extraction by scp
RUN apk add --no-cache imagemagick font-comic-neue@testing
RUN magick -background none -fill black -font Comic-Neue-Angular-Bold-Italic -pointsize 72 label:$(cat pass) /home/$USER/password.png
RUN apk remove imagemagick font-comic-neue@test
RUN rm ./pass



